---
import { Button } from "@/components/ui/button";
import "@/global.css";
import Layout from '../layouts/layout.astro';
import fetchApi from "../lib/strapi";

const STRAPI_URL = import.meta.env.STRAPI_URL;

interface Sponsor {
  id: number;
  attributes: {
    Name: string;
    Type: 'Gold' | 'Silver' | 'Bronze' | 'Tech' | 'Community';
    Logo: {
      data: {
        attributes: {
          formats: {
            small: {
              url: string;
            };
          };
        };
      };
    };
  };
}

const index = await fetchApi<any>({
  endpoint: "index?populate=*",
  wrappedByKey: "data",
});

const sponsors = await fetchApi<any>({
  endpoint: "sponsors?populate=*",
  wrappedByKey: "data",
});

const sponsorCategories: Record<'Gold' | 'Silver' | 'Bronze' | 'Tech' | 'Community', Sponsor[]> = {
  Gold: [],
  Silver: [],
  Bronze: [],
  Tech: [],
  Community: [],
};

sponsors.forEach((sponsor: Sponsor) => {
  const type = sponsor.attributes.Type;
  if (sponsorCategories[type]) {
    sponsorCategories[type].push(sponsor);
  }
});

// Define paths for singular and plural images
const titleImages: Record<'Gold' | 'Silver' | 'Bronze' | 'Tech' | 'Community', { singular: string; plural: string }> = {
  Gold: {
    singular: '/images/gold-sponsor.png',
    plural: '/images/gold-sponsors.png'
  },
  Silver: {
    singular: '/images/silver-sponsor.png',
    plural: '/images/silver-sponsors.png'
  },
  Bronze: {
    singular: '/images/bronze-sponsor.png',
    plural: '/images/bronze-sponsors.png'
  },
  Tech: {
    singular: '/images/tech-sponsor.png',
    plural: '/images/tech-sponsors.png'
  },
  Community: {
    singular: '/images/community-sponsor.png',
    plural: '/images/community-sponsors.png'
  }
};
---

<Layout title='WDCC' description="The Web Development & Consulting Club @ The University of Auckland">
  <div class="content">
    <h1>Test H1</h1>
    <h2>Test H2</h2>
    <h3>Test H3</h3>
    <h4>Test H4</h4>
    <p>Test P</p>
    <p class="text-sm">Text xs</p>
    <Button>Hello</Button>
  </div>

  <div class="sponsors-container">
    <div class="sponsors-text">
      <h2>Supported by our 2024 Sponsors</h2>
    </div>
    <div class="sponsors-sections">
      {Object.entries(sponsorCategories).map(([category, sponsors]) => (
        sponsors.length > 0 && (
          <div class="sponsor-section">
            <img
              src={sponsors.length === 1 ? titleImages[category as 'Gold' | 'Silver' | 'Bronze' | 'Tech' | 'Community'].singular : titleImages[category as 'Gold' | 'Silver' | 'Bronze' | 'Tech' | 'Community'].plural}
              alt={`${category} Sponsor`}
              class="sponsor-section__title-image"
            />
            <div class="sponsor-section__list">
              {sponsors.map((sponsor: Sponsor) => (
                <div class="sponsor">
                  <div class="sponsor__logo-container">
                    <img src={STRAPI_URL + sponsor.attributes.Logo.data.attributes.formats.small.url} alt={sponsor.attributes.Name} class="sponsor__logo" />
                  </div>
                </div>
              ))}
            </div>
          </div>
        )
      ))}
    </div>
  </div>
</Layout>

<style>
.content {
  padding: 2rem;
}

.sponsors-container {
  display: flex;
  align-items: center; /* Center items vertically */
  padding: 2rem;
}

.sponsors-text {
  flex: none; /* Prevent the text container from growing or shrinking */
  width: 300px; /* Set a fixed width */
  display: flex;
  align-items: center; /* Center text vertically */
  margin-right: 4rem; /* Adjust spacing to the right */
  color: #087DF1;
}

.sponsors-text h2 {
  margin: 0;
  text-align: left; /* Ensure text is left-aligned */
}

.sponsors-sections {
  flex: 3;
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.sponsor-section {
  width: 100%;
}

.sponsor-section__title-image {
  display: block;
  max-width: 250px;
  margin: 2rem 0 2rem 0;
  height: 35px;
}

.sponsor-section__list {
  display: flex;
  flex-wrap: wrap;
  justify-content: center; /* Center logos horizontally */
  gap: 2rem;
}

.sponsor {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 150px; /* Adjust as needed for uniform size */
}

.sponsor__logo-container {
  width: 140px;  /* Set the desired width */
  height: 80px;  /* Set the desired height */
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden; /* Ensure any overflow is hidden */
}

.sponsor__logo {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain; /* Ensure logos are scaled to fit without distortion */
}
</style>
